<h1 class="mb-4 text-center">Edit Listing</h1>

<div class="container d-flex justify-content-center mb-5">
  <div class="card shadow-lg p-4" style="width: 80%; max-width: 1000px;">

    <form action="/listings/<%= listing._id %>?_method=PUT" method="POST" enctype="multipart/form-data">

      <!-- CURRENT IMAGE -->
      <div class="mb-4 text-center">
        <% if (listing.image && listing.image.length > 0) { %>
          <img 
            src="<%= listing.image[0].url %>" 
            class="img-fluid rounded shadow mb-3"
            style="width: 100%; max-height: 400px; object-fit: cover;"
            alt="Listing image"
          >
          <div class="form-check d-flex justify-content-center">
            <input class="form-check-input me-2" type="checkbox" id="removeImage" name="removeImage" value="true">
            <label class="form-check-label" for="removeImage">
              Remove existing image
            </label>
          </div>
        <% } else { %>
          <img 
            src="https://via.placeholder.com/800x400?text=No+Image"
            class="img-fluid rounded shadow mb-3"
            style="width: 100%; max-height: 400px; object-fit: cover;"
          >
          <p class="text-muted">No image currently uploaded.</p>
        <% } %>
      </div>

      <!-- UPLOAD NEW IMAGE -->
      <div class="mb-4">
        <label for="image" class="form-label fw-semibold">
          Upload New Image (replaces existing)
        </label>
        <input class="form-control" type="file" id="image" name="image" accept="image/*">
      </div>

      <hr class="my-4">

      <!-- TITLE -->
      <div class="mb-3">
        <label for="title" class="form-label fw-semibold">Title</label>
        <input type="text" class="form-control" id="title" name="title" value="<%= listing.title %>" required>
      </div>

      <!-- PRICE -->
      <div class="mb-3">
        <label for="price" class="form-label fw-semibold">Price</label>
        <input type="number" class="form-control" id="price" name="price" value="<%= listing.price %>" required>
      </div>

      <!-- DESCRIPTION -->
      <div class="mb-3">
        <label for="description" class="form-label fw-semibold">Description</label>
        <textarea class="form-control" id="description" name="description" rows="4" required><%= listing.description %></textarea>
      </div>

      <!-- LOCATION & COUNTRY -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="location" class="form-label fw-semibold">Location</label>
          <input type="text" class="form-control" id="location" name="location" value="<%= listing.location %>">
        </div>

        <div class="col-md-6 mb-3">
          <label for="country" class="form-label fw-semibold">Country</label>
          <input type="text" class="form-control" id="country" name="country" value="<%= listing.country %>">
        </div>
      </div>

      <!-- BUTTONS -->
      <div class="text-center mt-4">
        <button type="submit" class="btn btn-primary px-5">
          Update Listing
        </button>
      </div>

    </form>
  </div>
</div>
